<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>Google výstup</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 800px;
      margin: 2rem auto;
      padding: 0 1rem;
    }
    h1 {
      margin-bottom: 1rem;
    }
    form {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    input[type="text"] {
      flex: 1;
      padding: 0.5rem 0.75rem;
      font-size: 1rem;
    }
    button {
      padding: 0.5rem 1rem;
      font-size: 1rem;
      cursor: pointer;
    }
    #status {
      margin-bottom: 1rem;
      min-height: 1.2em;
      font-size: 0.9rem;
      color: #555;
    }
    .result {
      margin-bottom: 1rem;
      border-bottom: 1px solid #ddd;
      padding-bottom: 0.5rem;
    }
    .result h2 {
      font-size: 1.05rem;
      margin: 0;
    }
    .result a {
      text-decoration: none;
      color: #1a0dab;
    }
    .result a:visited {
      color: #660099;
    }
    .result .link {
      font-size: 0.85rem;
      color: #006621;
      word-break: break-all;
    }
    .result .snippet {
      font-size: 0.9rem;
      color: #333;
      margin-top: 0.25rem;
    }
  </style>
</head>
<body>
  <h1>Google výstup</h1>

  <form id="search-form">
    <input id="query" type="text" placeholder="Zadej hledaný výraz..." required>
    <button type="submit">Hledat</button>
  </form>

  <div id="status"></div>
  <div id="results"></div>

  <script>
    const form = document.getElementById('search-form');
    const queryInput = document.getElementById('query');
    const statusEl = document.getElementById('status');
    const resultsEl = document.getElementById('results');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const q = queryInput.value.trim();
      if (!q) return;

      statusEl.textContent = 'Hledám...';
      resultsEl.innerHTML = '';

      try {
        const resp = await fetch(`/api/search?q=${encodeURIComponent(q)}`);
        if (!resp.ok) {
          throw new Error(`HTTP ${resp.status}`);
        }
        const data = await resp.json();

        statusEl.textContent = `Nalezeno ${data.count} výsledků.`;

        if (!data.results || data.results.length === 0) {
          resultsEl.innerHTML = '<p>Žádné výsledky.</p>';
          return;
        }

        for (const r of data.results) {
          const div = document.createElement('div');
          div.className = 'result';

          const h2 = document.createElement('h2');
          const a = document.createElement('a');
          a.href = r.link;
          a.target = '_blank';
          a.rel = 'noopener noreferrer';
          a.textContent = r.title || r.link;
          h2.appendChild(a);

          const linkDiv = document.createElement('div');
          linkDiv.className = 'link';
          linkDiv.textContent = r.link;

          const snippetDiv = document.createElement('div');
          snippetDiv.className = 'snippet';
          snippetDiv.textContent = r.snippet || '';

          div.appendChild(h2);
          div.appendChild(linkDiv);
          div.appendChild(snippetDiv);

          resultsEl.appendChild(div);
        }
      } catch (err) {
        console.error(err);
        statusEl.textContent = 'Došlo k chybě při vyhledávání.';
      }
    });
  </script>
</body>
</html>